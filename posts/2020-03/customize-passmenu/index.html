<!doctype html><html lang=ja dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>passmenu をカスタマイズしてみました | My Hugo Blog</title><meta name=keywords content><meta name=description content="パスワードマネージャーには Pass / password-store を使っていて、 GUI 環境での入力には passmenu を使っているのですが、 passmenu のデフォルト動作は クリップボードへのコピーで、 直接入力させるには --type オプションを付ける必要があり少し面倒だったので、動作をカスタマイズしてみました。
オリジナルのソースは contrib/dmenu にあります。 pass は全体がそうなのですが、中身はシンプルな bash スクリプトなので、好きなように修正してしまいます。
#!/usr/bin/env bash  shopt -s nullglob globstar line=1 if [[ &#34;$1&#34; =~ ^[0-9]+$ ]]; then line=$1 shift fi prefix=${PASSWORD_STORE_DIR-~/.password-store} password_files=( &#34;$prefix&#34;/**/*.gpg ) password_files=( &#34;${password_files[@]#&#34;$prefix&#34;/}&#34; ) password_files=( &#34;${password_files[@]%.gpg}&#34; ) password=$(printf '%s\n' &#34;${password_files[@]}&#34; | dmenu) [[ -n $password ]] || exit pass $@ &#34;$password&#34; | tail -n+$line | head -n1 | tr -d '\n' | xdotool type --clearmodifiers --file -  直接 type して欲しいときの方が多いのでデフォルト動作を type に変更 (コピーしたかったら pass コマンドを使うので、というか直接 type させる以外する必要ない気が……) 複数行に対応するため、1つめの引数が数字であればその行を出力するように変更 otp なども入力できるように、以降の引数は dmenu ではなく pass に渡すように変更  などをしました。"><meta name=author content><link rel=canonical href=https://ny-a.github.io/hugo-blog/posts/2020-03/customize-passmenu/><link crossorigin=anonymous href=/hugo-blog/assets/css/stylesheet.min.35cd0f65a15cafa92372b8313deef5960aae04b90ad722f2bbf509eb0468137e.css integrity="sha256-Nc0PZaFcr6kjcrgxPe71lgquBLkK1yLyu/UJ6wRoE34=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/hugo-blog/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://ny-a.github.io/hugo-blog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ny-a.github.io/hugo-blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ny-a.github.io/hugo-blog/favicon-32x32.png><link rel=apple-touch-icon href=https://ny-a.github.io/hugo-blog/apple-touch-icon.png><link rel=mask-icon href=https://ny-a.github.io/hugo-blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><meta property="og:title" content="passmenu をカスタマイズしてみました"><meta property="og:description" content="パスワードマネージャーには Pass / password-store を使っていて、 GUI 環境での入力には passmenu を使っているのですが、 passmenu のデフォルト動作は クリップボードへのコピーで、 直接入力させるには --type オプションを付ける必要があり少し面倒だったので、動作をカスタマイズしてみました。
オリジナルのソースは contrib/dmenu にあります。 pass は全体がそうなのですが、中身はシンプルな bash スクリプトなので、好きなように修正してしまいます。
#!/usr/bin/env bash  shopt -s nullglob globstar line=1 if [[ &#34;$1&#34; =~ ^[0-9]+$ ]]; then line=$1 shift fi prefix=${PASSWORD_STORE_DIR-~/.password-store} password_files=( &#34;$prefix&#34;/**/*.gpg ) password_files=( &#34;${password_files[@]#&#34;$prefix&#34;/}&#34; ) password_files=( &#34;${password_files[@]%.gpg}&#34; ) password=$(printf '%s\n' &#34;${password_files[@]}&#34; | dmenu) [[ -n $password ]] || exit pass $@ &#34;$password&#34; | tail -n+$line | head -n1 | tr -d '\n' | xdotool type --clearmodifiers --file -  直接 type して欲しいときの方が多いのでデフォルト動作を type に変更 (コピーしたかったら pass コマンドを使うので、というか直接 type させる以外する必要ない気が……) 複数行に対応するため、1つめの引数が数字であればその行を出力するように変更 otp なども入力できるように、以降の引数は dmenu ではなく pass に渡すように変更  などをしました。"><meta property="og:type" content="article"><meta property="og:url" content="https://ny-a.github.io/hugo-blog/posts/2020-03/customize-passmenu/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-03-03T00:00:00+00:00"><meta property="article:modified_time" content="2020-03-03T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="passmenu をカスタマイズしてみました"><meta name=twitter:description content="パスワードマネージャーには Pass / password-store を使っていて、 GUI 環境での入力には passmenu を使っているのですが、 passmenu のデフォルト動作は クリップボードへのコピーで、 直接入力させるには --type オプションを付ける必要があり少し面倒だったので、動作をカスタマイズしてみました。
オリジナルのソースは contrib/dmenu にあります。 pass は全体がそうなのですが、中身はシンプルな bash スクリプトなので、好きなように修正してしまいます。
#!/usr/bin/env bash  shopt -s nullglob globstar line=1 if [[ &#34;$1&#34; =~ ^[0-9]+$ ]]; then line=$1 shift fi prefix=${PASSWORD_STORE_DIR-~/.password-store} password_files=( &#34;$prefix&#34;/**/*.gpg ) password_files=( &#34;${password_files[@]#&#34;$prefix&#34;/}&#34; ) password_files=( &#34;${password_files[@]%.gpg}&#34; ) password=$(printf '%s\n' &#34;${password_files[@]}&#34; | dmenu) [[ -n $password ]] || exit pass $@ &#34;$password&#34; | tail -n+$line | head -n1 | tr -d '\n' | xdotool type --clearmodifiers --file -  直接 type して欲しいときの方が多いのでデフォルト動作を type に変更 (コピーしたかったら pass コマンドを使うので、というか直接 type させる以外する必要ない気が……) 複数行に対応するため、1つめの引数が数字であればその行を出力するように変更 otp なども入力できるように、以降の引数は dmenu ではなく pass に渡すように変更  などをしました。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ny-a.github.io/hugo-blog/posts/"},{"@type":"ListItem","position":2,"name":"passmenu をカスタマイズしてみました","item":"https://ny-a.github.io/hugo-blog/posts/2020-03/customize-passmenu/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"passmenu をカスタマイズしてみました","name":"passmenu をカスタマイズしてみました","description":"パスワードマネージャーには Pass / password-store を使っていて、 GUI 環境での入力には passmenu を使っているのですが、 passmenu のデフォルト動作は クリップボードへのコピーで、 直接入力させるには --type オプションを付ける必要があり少し面倒だったので、動作をカスタマイズしてみました。\nオリジナルのソースは contrib/dmenu にあります。 pass は全体がそうなのですが、中身はシンプルな bash スクリプトなので、好きなように修正してしまいます。\n#!/usr/bin/env bash  shopt -s nullglob globstar line=1 if [[ \u0026#34;$1\u0026#34; =~ ^[0-9]+$ ]]; then line=$1 shift fi prefix=${PASSWORD_STORE_DIR-~/.password-store} password_files=( \u0026#34;$prefix\u0026#34;/**/*.gpg ) password_files=( \u0026#34;${password_files[@]#\u0026#34;$prefix\u0026#34;/}\u0026#34; ) password_files=( \u0026#34;${password_files[@]%.gpg}\u0026#34; ) password=$(printf \u0026#39;%s\\n\u0026#39; \u0026#34;${password_files[@]}\u0026#34; | dmenu) [[ -n $password ]] || exit pass $@ \u0026#34;$password\u0026#34; | tail -n+$line | head -n1 | tr -d \u0026#39;\\n\u0026#39; | xdotool type --clearmodifiers --file -  直接 type して欲しいときの方が多いのでデフォルト動作を type に変更 (コピーしたかったら pass コマンドを使うので、というか直接 type させる以外する必要ない気が……) 複数行に対応するため、1つめの引数が数字であればその行を出力するように変更 otp なども入力できるように、以降の引数は dmenu ではなく pass に渡すように変更  などをしました。","keywords":[],"articleBody":"パスワードマネージャーには Pass / password-store を使っていて、 GUI 環境での入力には passmenu を使っているのですが、 passmenu のデフォルト動作は クリップボードへのコピーで、 直接入力させるには --type オプションを付ける必要があり少し面倒だったので、動作をカスタマイズしてみました。\nオリジナルのソースは contrib/dmenu にあります。 pass は全体がそうなのですが、中身はシンプルな bash スクリプトなので、好きなように修正してしまいます。\n#!/usr/bin/env bash  shopt -s nullglob globstar line=1 if [[ \"$1\" =~ ^[0-9]+$ ]]; then line=$1 shift fi prefix=${PASSWORD_STORE_DIR-~/.password-store} password_files=( \"$prefix\"/**/*.gpg ) password_files=( \"${password_files[@]#\"$prefix\"/}\" ) password_files=( \"${password_files[@]%.gpg}\" ) password=$(printf '%s\\n' \"${password_files[@]}\" | dmenu) [[ -n $password ]] || exit pass $@ \"$password\" | tail -n+$line | head -n1 | tr -d '\\n' | xdotool type --clearmodifiers --file -  直接 type して欲しいときの方が多いのでデフォルト動作を type に変更 (コピーしたかったら pass コマンドを使うので、というか直接 type させる以外する必要ない気が……) 複数行に対応するため、1つめの引数が数字であればその行を出力するように変更 otp なども入力できるように、以降の引数は dmenu ではなく pass に渡すように変更  などをしました。\ndmenu にオプション渡してどうしたいんだろう……と思ってしまいました。 dmenu に慣れていないだけなんでしょうか？ それはともかく、パスワードを pass にがっつり依存してしまっているので、このスクリプトでかなり便利になりました。\npass was written by Jason A. Donenfeld of zx2c4.com and is licensed under the GPLv2+\ncontrib なのでライセンス違うような気もしますがそうでもない気もします。contrib だから違うってことはないか。はい。\n","wordCount":"122","inLanguage":"ja","datePublished":"2020-03-03T00:00:00Z","dateModified":"2020-03-03T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://ny-a.github.io/hugo-blog/posts/2020-03/customize-passmenu/"},"publisher":{"@type":"Organization","name":"My Hugo Blog","logo":{"@type":"ImageObject","url":"https://ny-a.github.io/hugo-blog/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://ny-a.github.io/hugo-blog/ accesskey=h title="My Hugo Blog (Alt + H)">My Hugo Blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://ny-a.github.io/hugo-blog/archives title=Archive><span>Archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ny-a.github.io/hugo-blog/>Home</a>&nbsp;»&nbsp;<a href=https://ny-a.github.io/hugo-blog/posts/>Posts</a></div><h1 class=post-title>passmenu をカスタマイズしてみました</h1><div class=post-meta>March 3, 2020&nbsp;·&nbsp;1 分</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>目次</div></summary><div class=inner></div></details></div><div class=post-content><p>パスワードマネージャーには <a href=https://www.passwordstore.org/>Pass / password-store</a> を使っていて、
GUI 環境での入力には <code>passmenu</code> を使っているのですが、 passmenu のデフォルト動作は クリップボードへのコピーで、
直接入力させるには <code>--type</code> オプションを付ける必要があり少し面倒だったので、動作をカスタマイズしてみました。</p><p>オリジナルのソースは <a href=https://git.zx2c4.com/password-store/tree/contrib/dmenu/passmenu>contrib/dmenu</a> にあります。
pass は全体がそうなのですが、中身はシンプルな bash スクリプトなので、好きなように修正してしまいます。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e>#!/usr/bin/env bash
</span><span style=color:#75715e></span>
shopt -s nullglob globstar

line<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
<span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span>~ ^<span style=color:#f92672>[</span>0-9<span style=color:#f92672>]</span>+$ <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
  line<span style=color:#f92672>=</span>$1
  shift
<span style=color:#66d9ef>fi</span>

prefix<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>PASSWORD_STORE_DIR-~/.password-store<span style=color:#e6db74>}</span>
password_files<span style=color:#f92672>=(</span> <span style=color:#e6db74>&#34;</span>$prefix<span style=color:#e6db74>&#34;</span>/**/*.gpg <span style=color:#f92672>)</span>
password_files<span style=color:#f92672>=(</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>password_files[@]#<span style=color:#e6db74>&#34;</span>$prefix<span style=color:#e6db74>&#34;</span>/<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>)</span>
password_files<span style=color:#f92672>=(</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>password_files[@]%.gpg<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>)</span>

password<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>printf <span style=color:#e6db74>&#39;%s\n&#39;</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>password_files[@]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> | dmenu<span style=color:#66d9ef>)</span>

<span style=color:#f92672>[[</span> -n $password <span style=color:#f92672>]]</span> <span style=color:#f92672>||</span> exit

pass $@ <span style=color:#e6db74>&#34;</span>$password<span style=color:#e6db74>&#34;</span> | tail -n+$line | head -n1 | tr -d <span style=color:#e6db74>&#39;\n&#39;</span> | xdotool type --clearmodifiers --file -
</code></pre></div><ul><li>直接 type して欲しいときの方が多いのでデフォルト動作を type に変更
(コピーしたかったら pass コマンドを使うので、というか直接 type させる以外する必要ない気が……)</li><li>複数行に対応するため、1つめの引数が数字であればその行を出力するように変更</li><li>otp なども入力できるように、以降の引数は dmenu ではなく pass に渡すように変更</li></ul><p>などをしました。</p><p>dmenu にオプション渡してどうしたいんだろう……と思ってしまいました。 dmenu に慣れていないだけなんでしょうか？
それはともかく、パスワードを pass にがっつり依存してしまっているので、このスクリプトでかなり便利になりました。</p><p>pass was written by Jason A. Donenfeld of zx2c4.com and is licensed under the <a href=http://www.gnu.org/licenses/gpl-2.0.html>GPLv2</a>+</p><p>contrib なのでライセンス違うような気もしますがそうでもない気もします。contrib だから違うってことはないか。はい。</p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://ny-a.github.io/hugo-blog/posts/2020-03/earlyoom-in-community-repo/><span class=title>« 前のページ</span><br><span>earlyoomがcommunityレポジトリに入っていました</span></a>
<a class=next href=https://ny-a.github.io/hugo-blog/posts/2020-03/scalajs-1-0-released/><span class=title>次のページ »</span><br><span>Scala.js 1.0 がリリースされました</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://ny-a.github.io/hugo-blog/>My Hugo Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script></body></html>